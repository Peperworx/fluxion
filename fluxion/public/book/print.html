<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Fluxion</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="foreward.html"><strong aria-hidden="true">1.</strong> Foreward</a></li><li class="chapter-item expanded "><a href="first_steps.html"><strong aria-hidden="true">2.</strong> First Steps</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="first_actor.html"><strong aria-hidden="true">2.1.</strong> Defining and Adding an Actor</a></li><li class="chapter-item expanded "><a href="first_message.html"><strong aria-hidden="true">2.2.</strong> Defining and Sending Messages</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Fluxion</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="foreward"><a class="header" href="#foreward">Foreward</a></h1>
<p>Fluxion exists to fulfill a very specific usecase: provide an actor system that can send messages between systems. How systems are connected does not matter. Be it through IPC, the internet, or even something like UART, Fluxion will provide the same interface. Fluxion is different from many traditional actor systems in that it does not provide actors mutable access to themselves, and it does not provide "fire and forget" messages.</p>
<p>Why does Fluxion make these two restrictions? If Fluxion were to provide actors mutable access to themselves, then message handlers would be unable to run concurrently. By definition, Fluxion would no longer be an actor system. By not providing "fire and forget" messages, Fluxion enables an optimization by which messages can be simulated via function calls. If "fire and forget" messages are required, then a user can simply spawn a new async task to send the message from.</p>
<p>That being said, Fluxion is <em>not</em> an actor framework. Fluxion is an actor <em>library</em>. Fluxion will not try to get in your way, and does not attempt to provide a system to build your entire application around. Instead, Fluxion is designed to be used a little bit, just where actors are actually needed: maybe for a plugin system, or maybe just to represent multiple different database connections with the same exact interface.</p>
<p>Due to Fluxion's limited scope, it is also <em>very</em> performant. On an I9-13900H with 32Gb of RAM, the <code>benchmark</code> example outputs ~16 million messages per second when compiled on release mode. Even when compiled using the <code>dev</code> profile, Fluxion still benchmarks ~6 million messages per second.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="first-steps"><a class="header" href="#first-steps">First Steps</a></h1>
<p>Lets start by creating a Cargo project (in the current directory) and adding Fluxion:</p>
<pre><code class="language-sh">cargo init project_name
cd project_name
cargo add fluxion
</code></pre>
<p>Fluxion needs to be called from an async context. As Fluxion is executor agnostic, it doesn't matter which library is used.
Here we will be using <a href="https://tokio.rs/">Tokio</a>, although any executor will work:</p>
<pre><code class="language-sh">cargo add tokio --features full
</code></pre>
<p>Next, we need to make the main function async, and import a few helpers from Fluxion, and create the Fluxion system:</p>
<pre><pre class="playground"><code class="language-rust">use fluxion::Fluxion;

#[tokio::main]
async fn main() {
    // Create the Fluxion system:
    let system = Fluxion::new("system_id", ());
}</code></pre></pre>
<p>The above code initializes a Fluxion system with the id "system_id" and the delegate <code>()</code>.</p>
<p>What is a delegate?</p>
<p>A delegate is an external type that provides methods to retrieve <code>MessageSender</code>s, which allow actors to communicate with actors on external systems. The unit type (<code>()</code>) is a simple delegate that always returns that no foreign actor was found. Later in this book, we will explore creating our own simple delegate.</p>
<p>Now that we have a system, we need to add an actor to it, and to do that, we must define an actor.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="defining-and-adding-an-actor"><a class="header" href="#defining-and-adding-an-actor">Defining and Adding an Actor</a></h1>
<p>Any type that is <code>Send</code>, <code>Sync</code>, and <code>'static</code> can implement <code>Actor</code>. Lets just create a unit type, and implement <code>Actor</code> on it:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fluxion::Actor;

struct MyActor;

impl Actor for MyActor {
    type Error = ();
}
<span class="boring">}</span></code></pre></pre>
<p>The only required field on an <code>Actor</code> is the <code>Error</code> type. This is the type returned as an error by the optional initialization and deinitialization methods. If you do not define your own initialization/deinitialization methods, you can just leave this as the unit type, as the default implementations will never return an error.</p>
<p>Adding an actor to the system is very easy:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let id = system.add(MyActor).await.unwrap();
<span class="boring">}</span></code></pre></pre>
<p>This runs the actor's initialization method, adds the actor to the system, and returns the actor's ID.</p>
<p>The actor's ID can be used to retrieve a reference to the actor from the system. There are two ways to retrieve an actor from the system: <code>get</code> and <code>get_local</code>. We will take a look at <code>get_local</code> first:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let actor_ref = system.get_local::&lt;TestActor&gt;(id).await.unwrap();
<span class="boring">}</span></code></pre></pre>
<p>The <code>get_local</code> method requires only the actor's type and ID, and returns a concrete type that depends on the actor's type. This allows a single actor reference to send any message that the actor implements, however, this message must reside on the local system.</p>
<p><code>get</code>, on the other hand, enables foreign messages, but also requires that the message type is specified. The returned type, however, is abstract over handlers of the message type.</p>
<p>To use <code>get</code>, we must first define a message type.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="defining-and-sending-messages"><a class="header" href="#defining-and-sending-messages">Defining and Sending Messages</a></h1>
<p>Defining a message in Fluxion is also very simple:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fluxion::Message;

struct MyMessage;

impl Message for MyMessage {
    type Result = ();
}
<span class="boring">}</span></code></pre></pre>
<p>The only field required by a message is the <code>Result</code> type, which is the type of the actor's response to the message.
Both messages and responses can be any type that is <code>Send</code> + <code>Sync</code> + <code>'static</code>.</p>
<p>Implementing a message handler on an actor is also relatively simple:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fluxion::Handler;

impl Handler&lt;MyMessage&gt; for MyActor {
    async fn handle_message&lt;D: Delegate&gt;(&amp;self, message: TestMessage, context: &amp;ActorContext&lt;D&gt;) {
        println!("{:?} received by {}", message, context.get_id());
    }
}

<span class="boring">}</span></code></pre></pre>
<p>Message handlers have access to the message, and to a context that provides information about the current actor, as well as access to the system to create more actors, and to send further messages.</p>
<p>Sending a message is pretty simple. Using the local handle we previously retrieved, we can send any message type that is handled by the actor:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use fluxion::MessageSender;

actor_ref.send(MyMessage).await;
<span class="boring">}</span></code></pre></pre>
<p>We do not need to unwrap this call, because message sending will never error, and just returns the type dictated by the message's result. In this case, we used <code>()</code>.</p>
<p>Now we can also retrieve a <code>MessageSender</code>, which can only send a specific message type:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let actor_ref = system.get::&lt;MyActor, MyMessage&gt;(id).await.unwrap();
actor_ref.send(MyMessage).await;
<span class="boring">}</span></code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
